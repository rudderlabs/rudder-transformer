import { mockFns } from '../mocks';
import { dummySourceConfig, note_attributes } from '../constants';

export const newWebhookcheckoutEventsTestScenarios = [
  {
    id: 'cs001',
    name: 'shopify',
    description: 'Track Call -> Server side Checkout Started triggered via webhook',
    module: 'source',
    skip: true,
    version: 'v2',
    input: {
      request: {
        body: [
          {
            request: {
              body: JSON.stringify({
                id: 35550298931313,
                token: '84ad78572dae52a8cbea7d55371afe89',
                cart_token: 'Z2NwLXVzLWVhc3QxOjAxSkJaTUVRSjgzNUJUN1BTNjEzRFdRUFFQ',
                email: null,
                gateway: null,
                buyer_accepts_marketing: false,
                buyer_accepts_sms_marketing: false,
                sms_marketing_phone: null,
                created_at: '2024-11-06T02:22:00+00:00',
                updated_at: '2024-11-05T21:22:02-05:00',
                landing_site: '/',
                note: '',
                note_attributes,
                referring_site: '',
                shipping_lines: [],
                shipping_address: [],
                taxes_included: false,
                total_weight: 0,
                currency: 'USD',
                completed_at: null,
                phone: null,
                customer_locale: 'en-US',
                line_items: [
                  {
                    key: '41327142600817',
                    fulfillment_service: 'manual',
                    gift_card: false,
                    grams: 0,
                    presentment_title: 'The Collection Snowboard: Hydrogen',
                    presentment_variant_title: '',
                    product_id: 7234590408817,
                    quantity: 1,
                    requires_shipping: true,
                    sku: '',
                    tax_lines: [],
                    taxable: true,
                    title: 'The Collection Snowboard: Hydrogen',
                    variant_id: 41327142600817,
                    variant_title: '',
                    variant_price: '600.00',
                    vendor: 'Hydrogen Vendor',
                    unit_price_measurement: {
                      measured_type: null,
                      quantity_value: null,
                      quantity_unit: null,
                      reference_value: null,
                      reference_unit: null,
                    },
                    compare_at_price: null,
                    line_price: '600.00',
                    price: '600.00',
                    applied_discounts: [],
                    destination_location_id: null,
                    user_id: null,
                    rank: null,
                    origin_location_id: null,
                    properties: {},
                  },
                ],
                name: '#35550298931313',
                abandoned_checkout_url:
                  'https://pixel-testing-rs.myshopify.com/59026964593/checkouts/ac/Z2NwLXVzLWVhc3QxOjAxSkJaTUVRSjgzNUJUN1BTNjEzRFdRUFFQ/recover?key=0385163be3875d3a2117e982d9cc3517&locale=en-US',
                discount_codes: [],
                tax_lines: [],
                presentment_currency: 'USD',
                source_name: 'web',
                total_line_items_price: '600.00',
                total_tax: '0.00',
                total_discounts: '0.00',
                subtotal_price: '600.00',
                total_price: '600.00',
                total_duties: '0.00',
                device_id: null,
                user_id: null,
                location_id: null,
                source_identifier: null,
                source_url: null,
                source: null,
                closed_at: null,
              }),
              query_parameters: {
                topic: ['checkouts_create'],
                version: ['pixel'],
                writeKey: ['2mw9SN679HngnXXXHT4oSVVBVmb'],
              },
              source: dummySourceConfig,
            },
          },
        ],
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
      },
      pathSuffix: '',
    },
    output: {
      response: {
        status: 200,
        body: [
          {
            output: {
              batch: [
                {
                  type: 'track',
                  event: 'Checkout Started Webhook',
                  properties: {
                    order_id: '35550298931313',
                    value: 600,
                    tax: 0,
                    currency: 'USD',
                    products: [
                      {
                        product_id: '7234590408817',
                        price: 600.0,
                        brand: 'Hydrogen Vendor',
                        quantity: 1,
                      },
                    ],
                  },
                  anonymousId: '50ead33e-d763-4854-b0ab-765859ef05cb',
                  context: {
                    library: {
                      eventOrigin: 'server',
                      name: 'RudderStack Shopify Cloud',
                      version: '2.0.0',
                    },
                    integration: {
                      name: 'SHOPIFY',
                    },
                    topic: 'checkouts_create',
                    cart_token: 'Z2NwLXVzLWVhc3QxOjAxSkJaTUVRSjgzNUJUN1BTNjEzRFdRUFFQ',
                    shopifyDetails: {
                      id: 35550298931313,
                      token: '84ad78572dae52a8cbea7d55371afe89',
                      cart_token: 'Z2NwLXVzLWVhc3QxOjAxSkJaTUVRSjgzNUJUN1BTNjEzRFdRUFFQ',
                      email: null,
                      gateway: null,
                      buyer_accepts_marketing: false,
                      buyer_accepts_sms_marketing: false,
                      sms_marketing_phone: null,
                      created_at: '2024-11-06T02:22:00+00:00',
                      updated_at: '2024-11-05T21:22:02-05:00',
                      landing_site: '/',
                      note: '',
                      note_attributes,
                      referring_site: '',
                      shipping_lines: [],
                      shipping_address: [],
                      taxes_included: false,
                      total_weight: 0,
                      currency: 'USD',
                      completed_at: null,
                      phone: null,
                      customer_locale: 'en-US',
                      line_items: [
                        {
                          key: '41327142600817',
                          fulfillment_service: 'manual',
                          gift_card: false,
                          grams: 0,
                          presentment_title: 'The Collection Snowboard: Hydrogen',
                          presentment_variant_title: '',
                          product_id: 7234590408817,
                          quantity: 1,
                          requires_shipping: true,
                          sku: '',
                          tax_lines: [],
                          taxable: true,
                          title: 'The Collection Snowboard: Hydrogen',
                          variant_id: 41327142600817,
                          variant_title: '',
                          variant_price: '600.00',
                          vendor: 'Hydrogen Vendor',
                          unit_price_measurement: {
                            measured_type: null,
                            quantity_value: null,
                            quantity_unit: null,
                            reference_value: null,
                            reference_unit: null,
                          },
                          compare_at_price: null,
                          line_price: '600.00',
                          price: '600.00',
                          applied_discounts: [],
                          destination_location_id: null,
                          user_id: null,
                          rank: null,
                          origin_location_id: null,
                          properties: {},
                        },
                      ],
                      name: '#35550298931313',
                      abandoned_checkout_url:
                        'https://pixel-testing-rs.myshopify.com/59026964593/checkouts/ac/Z2NwLXVzLWVhc3QxOjAxSkJaTUVRSjgzNUJUN1BTNjEzRFdRUFFQ/recover?key=0385163be3875d3a2117e982d9cc3517&locale=en-US',
                      discount_codes: [],
                      tax_lines: [],
                      presentment_currency: 'USD',
                      source_name: 'web',
                      total_line_items_price: '600.00',
                      total_tax: '0.00',
                      total_discounts: '0.00',
                      subtotal_price: '600.00',
                      total_price: '600.00',
                      total_duties: '0.00',
                      device_id: null,
                      user_id: null,
                      location_id: null,
                      source_identifier: null,
                      source_url: null,
                      source: null,
                      closed_at: null,
                    },
                    traits: {
                      cart_token_hash: '9125e1da-57b9-5bdc-953e-eb2b0ded5edc',
                    },
                  },
                  integrations: {
                    SHOPIFY: true,
                    DATA_WAREHOUSE: {
                      options: {
                        jsonPaths: ['track.context.shopifyDetails'],
                      },
                    },
                  },
                  timestamp: '2024-11-06T02:22:02.000Z',
                },
              ],
            },
          },
        ],
      },
    },
  },
  {
    id: 'cs002',
    name: 'shopify',
    description: 'Track Call -> Server side Order Cancelled triggered via webhook',
    module: 'source',
    skip: true,
    version: 'v2',
    input: {
      request: {
        body: [
          {
            request: {
              body: JSON.stringify({
                email: 'henry@wfls.com',
                total_price: '600.00',
                total_tax: '0.00',
                updated_at: '2024-11-05T21:54:50-05:00',
                line_items: [
                  {
                    id: 14234727743601,
                    name: 'The Collection Snowboard: Hydrogen',
                    price: '600.00',
                    product_id: 7234590408817,
                    quantity: 1,
                    sku: '',
                    title: 'The Collection Snowboard: Hydrogen',
                    total_discount: '0.00',
                    variant_id: 41327142600817,
                    vendor: 'Hydrogen Vendor',
                  },
                ],
                shipping_address: {
                  first_name: 'henry',
                  address1: 'Yuimaru Kitchen',
                  city: 'Johnson City',
                  zip: '37604',
                },
              }),
              query_parameters: {
                topic: ['orders_cancelled'],
                version: ['pixel'],
                writeKey: ['2mw9SN679HngnZkCHT4oSVVBVmb'],
              },
            },
            source: dummySourceConfig,
          },
        ],
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
      },
      pathSuffix: '',
    },
    output: {
      response: {
        status: 200,
        body: [
          {
            output: {
              batch: [
                {
                  type: 'track',
                  event: 'Order Cancelled',
                  properties: {
                    products: [
                      {
                        brand: 'Hydrogen Vendor',
                        price: 600,
                        product_id: '7234590408817',
                        quantity: 1,
                        title: 'The Collection Snowboard: Hydrogen',
                      },
                    ],
                    tax: 0,
                    value: 600,
                  },
                  context: {
                    integration: {
                      name: 'SHOPIFY',
                    },
                    library: {
                      eventOrigin: 'server',
                      name: 'RudderStack Shopify Cloud',
                      version: '2.0.0',
                    },
                    shopifyDetails: {
                      email: 'henry@wfls.com',
                      line_items: [
                        {
                          id: 14234727743601,
                          name: 'The Collection Snowboard: Hydrogen',
                          price: '600.00',
                          product_id: 7234590408817,
                          quantity: 1,
                          sku: '',
                          title: 'The Collection Snowboard: Hydrogen',
                          total_discount: '0.00',
                          variant_id: 41327142600817,
                          vendor: 'Hydrogen Vendor',
                        },
                      ],
                      shipping_address: {
                        address1: 'Yuimaru Kitchen',
                        city: 'Johnson City',
                        first_name: 'henry',
                        zip: '37604',
                      },
                      total_price: '600.00',
                      total_tax: '0.00',
                      updated_at: '2024-11-05T21:54:50-05:00',
                    },
                    traits: {
                      email: 'henry@wfls.com',
                      address: {
                        street: 'Yuimaru Kitchen',
                        city: 'Johnson City',
                        postalCode: '37604',
                      },
                    },
                    topic: 'orders_cancelled',
                  },
                  integrations: {
                    SHOPIFY: true,
                    DATA_WAREHOUSE: {
                      options: {
                        jsonPaths: ['track.context.shopifyDetails'],
                      },
                    },
                  },
                  timestamp: '2024-11-06T02:54:50.000Z',
                },
              ],
            },
          },
        ],
      },
    },
  },
  {
    id: 'cs003',
    name: 'shopify',
    description:
      'Track Call -> Server side Checkout Started triggered via webhook, with no anonymoudId in redis. anonymousId is set as hash of cart_token (race condition scenario)',
    module: 'source',
    skip: true,
    version: 'v2',
    input: {
      request: {
        body: [
          {
            request: {
              body: JSON.stringify({
                id: 35550298931313,
                token: '84ad78572dae52a8cbea7d55371afe89',
                cart_token: 'Z2NwLXVzLWVhc3QxOjAxSkJaTUVRSjgzNUJUN1BTNjEzRFdRUFFQ',
                email: null,
                gateway: null,
                buyer_accepts_marketing: false,
                buyer_accepts_sms_marketing: false,
                sms_marketing_phone: null,
                created_at: '2024-11-06T02:22:00+00:00',
                updated_at: '2024-11-05T21:22:02-05:00',
                landing_site: '/',
                note: '',
                note_attributes: [],
                referring_site: '',
                shipping_lines: [],
                shipping_address: [],
                taxes_included: false,
                total_weight: 0,
                currency: 'USD',
                completed_at: null,
                phone: null,
                customer_locale: 'en-US',
                line_items: [
                  {
                    key: '41327142600817',
                    fulfillment_service: 'manual',
                    gift_card: false,
                    grams: 0,
                    presentment_title: 'The Collection Snowboard: Hydrogen',
                    presentment_variant_title: '',
                    product_id: 7234590408817,
                    quantity: 1,
                    requires_shipping: true,
                    sku: '',
                    tax_lines: [],
                    taxable: true,
                    title: 'The Collection Snowboard: Hydrogen',
                    variant_id: 41327142600817,
                    variant_title: '',
                    variant_price: '600.00',
                    vendor: 'Hydrogen Vendor',
                    unit_price_measurement: {
                      measured_type: null,
                      quantity_value: null,
                      quantity_unit: null,
                      reference_value: null,
                      reference_unit: null,
                    },
                    compare_at_price: null,
                    line_price: '600.00',
                    price: '600.00',
                    applied_discounts: [],
                    destination_location_id: null,
                    user_id: null,
                    rank: null,
                    origin_location_id: null,
                    properties: {},
                  },
                ],
                name: '#35550298931313',
                abandoned_checkout_url:
                  'https://pixel-testing-rs.myshopify.com/59026964593/checkouts/ac/Z2NwLXVzLWVhc3QxOjAxSkJaTUVRSjgzNUJUN1BTNjEzRFdRUFFQ/recover?key=0385163be3875d3a2117e982d9cc3517&locale=en-US',
                discount_codes: [],
                tax_lines: [],
                presentment_currency: 'USD',
                source_name: 'web',
                total_line_items_price: '600.00',
                total_tax: '0.00',
                total_discounts: '0.00',
                subtotal_price: '600.00',
                total_price: '600.00',
                total_duties: '0.00',
                device_id: null,
                user_id: null,
                location_id: null,
                source_identifier: null,
                source_url: null,
                source: null,
                closed_at: null,
              }),
              query_parameters: {
                topic: ['checkouts_create'],
                version: ['pixel'],
                writeKey: ['2mw9SN679HngnXXXHT4oSVVBVmb'],
              },
            },
            source: dummySourceConfig,
          },
        ],
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
      },
      pathSuffix: '',
    },
    output: {
      response: {
        status: 200,
        body: [
          {
            output: {
              batch: [
                {
                  type: 'track',
                  event: 'Checkout Started Webhook',
                  anonymousId: '9125e1da-57b9-5bdc-953e-eb2b0ded5edc',
                  properties: {
                    order_id: '35550298931313',
                    value: 600,
                    tax: 0,
                    currency: 'USD',
                    products: [
                      {
                        product_id: '7234590408817',
                        price: 600.0,
                        brand: 'Hydrogen Vendor',
                        quantity: 1,
                      },
                    ],
                  },
                  context: {
                    library: {
                      eventOrigin: 'server',
                      name: 'RudderStack Shopify Cloud',
                      version: '2.0.0',
                    },
                    integration: {
                      name: 'SHOPIFY',
                    },
                    topic: 'checkouts_create',
                    cart_token: 'Z2NwLXVzLWVhc3QxOjAxSkJaTUVRSjgzNUJUN1BTNjEzRFdRUFFQ',
                    shopifyDetails: {
                      id: 35550298931313,
                      token: '84ad78572dae52a8cbea7d55371afe89',
                      cart_token: 'Z2NwLXVzLWVhc3QxOjAxSkJaTUVRSjgzNUJUN1BTNjEzRFdRUFFQ',
                      email: null,
                      gateway: null,
                      buyer_accepts_marketing: false,
                      buyer_accepts_sms_marketing: false,
                      sms_marketing_phone: null,
                      created_at: '2024-11-06T02:22:00+00:00',
                      updated_at: '2024-11-05T21:22:02-05:00',
                      landing_site: '/',
                      note: '',
                      note_attributes: [],
                      referring_site: '',
                      shipping_lines: [],
                      shipping_address: [],
                      taxes_included: false,
                      total_weight: 0,
                      currency: 'USD',
                      completed_at: null,
                      phone: null,
                      customer_locale: 'en-US',
                      line_items: [
                        {
                          key: '41327142600817',
                          fulfillment_service: 'manual',
                          gift_card: false,
                          grams: 0,
                          presentment_title: 'The Collection Snowboard: Hydrogen',
                          presentment_variant_title: '',
                          product_id: 7234590408817,
                          quantity: 1,
                          requires_shipping: true,
                          sku: '',
                          tax_lines: [],
                          taxable: true,
                          title: 'The Collection Snowboard: Hydrogen',
                          variant_id: 41327142600817,
                          variant_title: '',
                          variant_price: '600.00',
                          vendor: 'Hydrogen Vendor',
                          unit_price_measurement: {
                            measured_type: null,
                            quantity_value: null,
                            quantity_unit: null,
                            reference_value: null,
                            reference_unit: null,
                          },
                          compare_at_price: null,
                          line_price: '600.00',
                          price: '600.00',
                          applied_discounts: [],
                          destination_location_id: null,
                          user_id: null,
                          rank: null,
                          origin_location_id: null,
                          properties: {},
                        },
                      ],
                      name: '#35550298931313',
                      abandoned_checkout_url:
                        'https://pixel-testing-rs.myshopify.com/59026964593/checkouts/ac/Z2NwLXVzLWVhc3QxOjAxSkJaTUVRSjgzNUJUN1BTNjEzRFdRUFFQ/recover?key=0385163be3875d3a2117e982d9cc3517&locale=en-US',
                      discount_codes: [],
                      tax_lines: [],
                      presentment_currency: 'USD',
                      source_name: 'web',
                      total_line_items_price: '600.00',
                      total_tax: '0.00',
                      total_discounts: '0.00',
                      subtotal_price: '600.00',
                      total_price: '600.00',
                      total_duties: '0.00',
                      device_id: null,
                      user_id: null,
                      location_id: null,
                      source_identifier: null,
                      source_url: null,
                      source: null,
                      closed_at: null,
                    },
                    traits: {
                      cart_token_hash: '9125e1da-57b9-5bdc-953e-eb2b0ded5edc',
                    },
                  },
                  integrations: {
                    SHOPIFY: true,
                    DATA_WAREHOUSE: {
                      options: {
                        jsonPaths: ['track.context.shopifyDetails'],
                      },
                    },
                  },
                  timestamp: '2024-11-06T02:22:02.000Z',
                },
              ],
            },
          },
        ],
      },
    },
  },
].map((d1) => ({ ...d1, mockFns }));
